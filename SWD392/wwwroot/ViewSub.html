<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <!-- HERE IS WHERE TO START IF TEST UPDATE SUBSCRIPTION -->
    <!-- AND DONT CLICK CANCEL CUZ IT RUIN THE FLOW (NOT FINISH) -->
    <form id="get-subscriptions-form">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <button type="submit">Get Subscriptions</button>
    </form>

    <div id="subscriptions"></div>

    <script>
        document.getElementById('get-subscriptions-form').addEventListener('submit', function (event) {
            event.preventDefault();

            var email = document.getElementById('email').value;

            fetch('http://localhost:5272/subscriptions?email=' + encodeURIComponent(email))
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    var subscriptionsDiv = document.getElementById('subscriptions');
                    subscriptionsDiv.innerHTML = '';

                    data.forEach(subscription => {
                        var subscriptionDiv = document.createElement('div');
                        subscriptionDiv.textContent = 'Subscription ID: ' + subscription.id + ', Package ID: ' + subscription.packageId;
                        subscriptionsDiv.appendChild(subscriptionDiv);

                        var updateButton = document.createElement('button');
                        updateButton.textContent = 'Update';
                        updateButton.addEventListener('click', function () {
                            var subscriptionId = subscription.id;
                            localStorage.setItem('subscriptionId', subscriptionId);
                            window.location.href = 'http://localhost:5272/Package.html?subscriptionId=' + encodeURIComponent(subscriptionId);
/*                            window.location.href = 'http://localhost:5272/subscription.html';*/
                        });
                        subscriptionsDiv.appendChild(updateButton);

                        var cancelButton = document.createElement('button');
                        cancelButton.textContent = 'Cancel';
                        cancelButton.addEventListener('click', function () {
                            var subscriptionId = subscription.id;
                            fetch('http://localhost:5272/cancelSubscription?subscriptionId=' + encodeURIComponent(subscriptionId))
                                .then(response => response.json())
                                .then(data => {
                                    console.log(data);
                                    if (data.status === "success") {
                                        window.alert("Subscription cancelled successfully. The subscription will remain active until the end of the current billing period.");
                                    } else {
                                        window.alert("An error occurred while cancelling the subscription. Please try again.");
                                    }
                                });
                        });
                        subscriptionsDiv.appendChild(cancelButton);
                    });
                });
        });
    </script>

</body>
</html>
