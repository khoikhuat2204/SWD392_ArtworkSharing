<!DOCTYPE html>
<html>
<head>
    <title>Cart</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <h1>Your Cart</h1>
    <div id="cart"></div>
    <button id="checkout-button">Checkout</button>

    <script>
        var stripe = Stripe('pk_test_51OsHZUGbEbQ0nPlDmozfqb0YVCLTp9jIhOZKwxbIDfYoQOR8yz5lyJdjTtRKN4mkOJVi2LDHAw86ksdapAFb3wUn00lnJawmvD'); // Replace with your Stripe public key
        $(document).ready(function () {
            // Fetch the cart items from the server
            $.get('https://localhost:7147/cart', function (data) {
                // For each item in the cart, add a div to the #cart div
                data.forEach(function (item) {
                    $('#cart').append(`
                                <div>
                                    <h2>${item.artworkName}</h2>
                                    <p>Price: $${item.artworkPrice}</p>
                                    <p>Quantity: ${item.quantity}</p>
                                    <button onclick="updateQuantity(${item.artworkId}, ${item.quantity + 1})">Increase Quantity</button>
                                    <button onclick="updateQuantity(${item.artworkId}, ${item.quantity - 1})">Decrease Quantity</button>
                                    <button onclick="removeFromCart(${item.artworkId})">Remove from Cart</button>
                                </div>
                            `);
                });
            });
        });

        $('#checkout').click(function () {
            window.location.href = 'cart.html';
        });


        function updateQuantity(id, quantity) {
            // Make a PUT request to update the quantity of the item
            fetch(`http://localhost:5272/updatecart/${id}/${quantity}`, { method: 'PUT' })
                .then(response => response.json())
                .then(data => {
                    // After updating, refresh the page to show the updated cart
                    location.reload();
                });
        }

        function removeFromCart(id) {
            // Make a DELETE request to remove the item from the cart
            fetch(`http://localhost:5272/deletecart/${id}`, { method: 'DELETE' })
                .then(response => response.json())
                .then(data => {
                    // After removing, refresh the page to show the updated cart
                    location.reload();
                });
        }

        // checkout button

        document.getElementById('checkout-button').addEventListener('click', function () {
            fetch('http://localhost:5272/create-checkout-session', { method: 'POST' })
                .then(function (response) {
                    return response.json();
                })
                .then(function (session) { 
                    return stripe.redirectToCheckout({ sessionId: session.id });
                })
                .then(function (result) {
                    if (result.error) {
                        alert(result.error.message);
                    }
                })
                .catch(function (error) {
                    console.error('Error:', error);
                });
        });
    </script>
</body>
</html>
